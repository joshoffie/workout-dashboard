<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Workout Tracker Web App</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
  :root {
    --color-bg: #f9fafb;
    --color-card: #ffffff;
    --color-primary: #3366ff;
    --color-accent: #ff7a59;
    --color-text: #333;
    --color-muted: #777;
    --radius: 12px;
    --shadow: 0 4px 20px rgba(0,0,0,0.05);
    --transition: 0.4s ease;
  }

  body {
    font-family: 'Inter', Arial, sans-serif;
    margin: 0; padding: 0;
    background: var(--color-bg);
    color: var(--color-text);
    overflow-x: hidden;
  }

  h1,h2,h3 { text-align: center; margin: 0 0 10px; }
  h1 { font-size: 3.5rem; font-weight: 600; margin-bottom: 30px; }
  h2 { font-size: 2.5rem; font-weight: 600; }
  h3 { font-size: 2rem; font-weight: 500; margin-bottom: 15px; }

  button { font-family: inherit; cursor: pointer; border: none; border-radius: var(--radius); transition: all var(--transition); }
  button:hover { filter: brightness(0.95); }

  /* ===== FULL-PAGE SECTIONS ===== */
  .section {
    position: absolute;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 20px;
    transition: transform 0.4s ease;
    overflow-y: auto;
    background: var(--color-bg);
  }
  .section.active-page { transform: translateX(0); z-index: 1; }
  .section.previous-page { transform: translateX(-100%); z-index: 0; }
  .section.next-page { transform: translateX(100%); z-index: 0; }

  /* ===== CARD CONTAINERS ===== */
  .list-container {
    background: var(--color-card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 30px;
    margin-bottom: 25px;
    width: 95%;
    max-width: 700px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .list-container ul {
    list-style: none; padding: 0; margin: 0; width: 100%;
  }
  .list-container li {
    padding: 16px 20px; border-bottom: 1px solid #eee;
    display: flex; justify-content: space-between; align-items: center; font-size: 1.4rem;
    transition: background var(--transition);
  }
  .list-container li:hover { background: #f0f4ff; }
  .list-container button {
    margin-top: 15px; background: var(--color-primary); color: white;
    padding: 14px 22px; font-weight: 600; font-size: 1.4rem;
  }

  table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 1.4rem; }
  table th, table td { text-align: center; padding: 14px; border-bottom: 1px solid #eee; }
  table th { background: #f5f6fa; font-weight: 600; }
  table tr:hover { background: #f0f4ff; }

  #graphDiv {
    margin-top: 30px;
    background: var(--color-card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 15px;
    width: 95%;
    max-width: 700px;
  }

  .back-btn {
    align-self: flex-start;
    margin-bottom: 20px;
    background: var(--color-accent);
    color: white;
    padding: 12px 18px;
    font-size: 1.3rem;
    font-weight: 600;
  }

  /* ===== LOGIN MODAL ===== */
  .overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex; align-items: center; justify-content: center;
    z-index: 1000; opacity: 0; pointer-events: none;
    transition: opacity 0.3s ease;
  }
  .overlay:not(.hidden) { opacity: 1; pointer-events: auto; }
  .modal {
    background: var(--color-card);
    border-radius: var(--radius);
    padding: 140px 80px; max-width: 600px; width: 90%;
    text-align: center; box-shadow: var(--shadow); position: relative;
  }
  .modal-logo {
    width: 130px; height: 130px; margin-bottom: 30px;
    animation: dumbbellSwing 2s infinite ease-in-out;
  }
  @keyframes dumbbellSwing {
    0% { transform: rotate(0deg) scale(1); }
    25% { transform: rotate(-10deg) scale(1.05); }
    50% { transform: rotate(0deg) scale(1); }
    75% { transform: rotate(10deg) scale(1.05); }
    100% { transform: rotate(0deg) scale(1); }
  }
  .modal h2 { font-size: 58px; font-weight: 600; margin-bottom: 25px; }
  .modal-subtitle { font-size: 32px; color: var(--color-muted); margin-bottom: 55px; line-height: 1.6; }
  #modalLoginBtn { background: var(--color-primary); color: white; padding: 28px 40px; font-size: 32px; font-weight: 600; width: 100%; display: flex; justify-content: center; align-items: center; gap: 15px; border-radius: var(--radius); }

  @media(max-width:480px){
    .section { padding: 15px; }
    .list-container { padding: 25px; }
    .list-container li { font-size: 1.6rem; padding: 18px 20px; }
    .list-container button { font-size: 1.6rem; padding: 16px 26px; }
    table th, table td { font-size: 1.6rem; padding: 16px; }
    .back-btn { font-size: 1.5rem; padding: 16px 24px; }
  }
</style>
</head>
<body>

<h1>Workout Tracker Web App</h1>

<!-- LOGIN MODAL -->
<div id="loginModal" class="overlay hidden">
  <div class="modal">
    <svg class="modal-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
      <rect x="10" y="28" width="44" height="8" fill="#555" rx="2"/>
      <rect x="4" y="22" width="6" height="20" fill="#888" rx="1"/>
      <rect x="0" y="26" width="4" height="12" fill="#bbb" rx="1"/>
      <rect x="54" y="22" width="6" height="20" fill="#888" rx="1"/>
      <rect x="60" y="26" width="4" height="12" fill="#bbb" rx="1"/>
    </svg>
    <h2>Welcome to Workout Tracker</h2>
    <p class="modal-subtitle">Sign in with your Google account to manage your workouts and clients.</p>
    <button id="modalLoginBtn">Login with Google</button>
  </div>
</div>

<!-- SECTIONS -->
<div id="clientsDiv" class="section active-page">
  <div id="authDiv">
    <button id="loginBtn">Login</button>
    <button id="logoutBtn" class="hidden">Logout</button>
    <span id="userLabel"></span>
  </div>
  <div class="list-container">
    <h3>Clients</h3>
    <button id="addClientBtn">Add Client</button>
    <ul id="clientList"></ul>
  </div>
</div>

<div id="sessionsDiv" class="section">
  <button class="back-btn">← Back</button>
  <div class="list-container">
    <h3>Sessions for <span id="selectedClientLabel"></span></h3>
    <button id="addSessionBtn">Add Session</button>
    <ul id="sessionList"></ul>
  </div>
</div>

<div id="exercisesDiv" class="section">
  <button class="back-btn">← Back</button>
  <div class="list-container">
    <h3>Exercises for <span id="selectedSessionLabel"></span></h3>
    <button id="addExerciseBtn">Add Exercise</button>
    <ul id="exerciseList"></ul>
  </div>
</div>

<div id="setsDiv" class="section">
  <button class="back-btn">← Back</button>
  <div class="list-container">
    <h3>Sets for <span id="selectedExerciseLabel"></span></h3>
    <button id="addSetBtn">Add Set</button>
    <button id="showGraphBtn">Show Progress Graph</button>
    <table id="setsTable">
      <thead>
        <tr><th>#</th><th>Reps</th><th>Weight</th><th>Volume</th><th>Notes</th><th>Timestamp</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="graphDiv" style="width:100%;height:400px;"></div>
</div>

<script src="app.js"></script>
<script>
  const modal = document.getElementById("loginModal");
  const modalLoginBtn = document.getElementById("modalLoginBtn");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const userLabel = document.getElementById("userLabel");

  auth.onAuthStateChanged(async user => {
    if(user){
      modal.classList.add("hidden");
      loginBtn.classList.add("hidden");
      logoutBtn.classList.remove("hidden");
      userLabel.textContent = `Logged in as ${user.displayName}`;
      await loadUserJson();
      renderClients();
    } else {
      modal.classList.remove("hidden");
      loginBtn.classList.remove("hidden");
      logoutBtn.classList.add("hidden");
      userLabel.textContent = "";
      clientsData = {};
      selectedClient = null;
      renderClients();
      hideAllDetails();
    }
  });

  modalLoginBtn.onclick = async () => { try{ const provider = new firebase.auth.GoogleAuthProvider(); await auth.signInWithPopup(provider);} catch(err){ alert("Login failed: "+err.message);} }
  logoutBtn.onclick = async () => { await auth.signOut(); }

  const sections = ['clientsDiv','sessionsDiv','exercisesDiv','setsDiv'];
  let currentIndex = 0;

  function showSection(index){
    if(index<0 || index>=sections.length) return;
    sections.forEach((id,i)=>{
      const el=document.getElementById(id);
      el.classList.remove('active-page','previous-page','next-page');
      if(i<index) el.classList.add('previous-page');
      else if(i===index) el.classList.add('active-page');
      else el.classList.add('next-page');
    });
    currentIndex=index;
  }

  document.querySelectorAll('.back-btn').forEach(btn=>{
    btn.addEventListener('click',()=>showSection(currentIndex-1));
  });

  let touchStartX=0;
  document.addEventListener('touchstart', e=>touchStartX=e.changedTouches[0].screenX);
  document.addEventListener('touchend', e=>{
    let touchEndX=e.changedTouches[0].screenX;
    let deltaX=touchEndX-touchStartX;
    if(Math.abs(deltaX)>50){
      if(deltaX<0 && currentIndex<sections.length-1) showSection(currentIndex+1);
      else if(deltaX>0 && currentIndex>0) showSection(currentIndex-1);
    }
  });
</script>
</body>
</html>
